---
title: "Visualizacion de datos con R: Shiny<br>Parte 2"
subtitle: "Diplomado en Data Science, MatPUC"
author: "Joshua Kunst"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "metropolis", "metropolis-fonts", "assets/custom.css"]
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

class: center, middle, inverse

# Antes de partir

---

# Antes de partir

<br>

La clase anterior está en https://datosuc.github.io/Visualizacion-de-datos-con-R/index.html

<br>

Esta clase está en https://datosuc.github.io/Visualizacion-de-datos-con-R/index2.html

<br>

Recordar paquetes con los cuales trabajaremos:

```r
install.packages(
  c("tidyverse", "shiny", "shinythemes", "shinyWidgets",
    "shinydashboard", "DT", "leaflet", "plotly")
  )
``` 

La infaltable chuleta: 

https://content.cdntwrk.com/files/aT0xMTI0NDEzJnY9MSZpc3N1ZU5hbWU9c2hpbnktc3BhbmlzaCZjbWQ9ZCZzaWc9ZTdhMThkY2VjYzM1YjkyNmI1NTVlNWM3ZWViNjE4MmU%253D


---

class: center, middle, inverse

# Shiny

---

# Fines educativos

<small>https://gallery.shinyapps.io/050-kmeans-example</small>

<iframe src="https://gallery.shinyapps.io/050-kmeans-example" width="100%" height="500px" ></iframe>


---

# Showcase/Demo/App

Paquete R para __X-13ARIMA-SEATS__ http://www.seasonal.website/

<iframe src="http://www.seasonal.website/" width="100%" height="500px" ></iframe>


---

class: center, middle, inverse

# Repaso resumido

---

# Repaso resumido

- Una shiny app consta de dos partes:
  - `ui` (**u**ser **i**nterface) donde definiremos el lugar de los los `input`s que el usuario podrá controlar, como también el lugar de donte estarán los `output`s que retornemos.
  - `server` (**server** XD), donde definiremos que retornaremos en cada output dependiendo de los inputs.

<hr>

- Los inputs de forma general son de la forma `tipoInput("nombreinput", parametros_del_inpout)`, por ejemplo
`sliderInput("valor", min = 1, max = 10, value = 1)`.
- En el server accedo al valor del input como `input$nombreinput`, siguiendo el ejemplo: `input$valor`, y 
particular en est ejmplo será númerico. 


<hr>

- Un output se define en la interfaz (gráfico, tabla, mapa, texto) con la forma `tipoOutput("nombreoutput")`, por ejemplo si quiero una salida/output tipo gráfico se usa `plotOutput("grafico")`
- Para enviar un grafico en el server se usa: `output$nombreoutput <- renderTipo({ codigo })`, por ejemplo:

`output$grafico <- renderPlot({ plot(rnorm(input$valor), type = "l") })`

---

# Repaso resumido

<br>

Así nuestra app de repaso quedaría:

```r
library(shiny)

# Antes del ui y server podemos cargar paquetes
# o datos que nuestra app usará. No tiene por que ser todo
# tan simple

ui <- fluidPage(
  sliderInput("valor", label = "Valor", min = 1, max = 10, value = 1),
  plotOutput("grafico")
  )

server <- function(input, output) {
  output$grafico <- renderPlot({ 
    plot(rnorm(input$valor), type = "l")
  })
}

shinyApp(ui, server)
```

---

class: center, middle, inverse

# Temas & estilos

---

# Temas & estilos

- Al principio todas nuestras app son similares.
- Existen extensiones/paquetes que permiten cambiar el estilo/look de la aplicación.

![](imgs/shinyapps.gif)



---

# shinythemes

Los más fácil de implementar, sin tan alto impacto en código ni imagen.

![](imgs/shinythemes.png)

---

# shinythemes

Antes:

```r
library(shiny)

ui <- fluidPage(
   sidebarLayout(...
```

Ahora:

```r
library(shiny)
library(shinythemes)

ui <- fluidPage(
   theme = shinytheme("superhero"),
   sidebarLayout(...
```

**NOTAR** que este cambio es solo en la parte ui. La parte del server no cambia.

---

# shinydashboard

Orientados a __dashboards__<span class="fragment"> agrega más funcionalidades</span>

![](https://rstudio.github.io/shinydashboard/images/crandash.png)

---

# shinydashboard

```r
library(shinydashboard)

ui <- dashboardPage(
  dashboardHeader(),
  dashboardSidebar(
     sliderInput("valor", label = "Valor", min = 1, max = 10, value = 1)
  ),
  dashboardBody(
    fluidRow(box(width = 12, plotOutput("grafico")))
  )
)
```

---

# Más y más templates y diseños

- shinydashboardPlus: https://rinterface.com/shiny/shinydashboardPlus/
- bs4Dash: https://rinterface.com/shiny/bs4Dash/classic/
- miniUI2Demo: https://dgranjon.shinyapps.io/miniUI2Demo
- tablerDash: https://rinterface.com/shiny/tablerDash/
---

class: center, middle, inverse

# Ejercicio: Aplicar temas

---

# Ejercicio Ejercicio 2

- Tomar la app de repaso y probar por al menos 2 temas (recomiendo *paper*) de `shinythemes`:
- Modifcar el ui utilizando el ejemplo de `shinydashboard` (copy+paste).

```r
library(shiny)

ui <- fluidPage(
  sliderInput("valor", label = "Valor", min = 1, max = 10, value = 1),
  plotOutput("grafico")
  )

server <- function(input, output) {
  output$grafico <- renderPlot({ 
    plot(rnorm(input$valor), type = "l")
  })
}

shinyApp(ui, server)
```

---

class: center, middle, inverse

# Publicar/Compartir tu app

---

# Publicar/Compartir tu app

<br> 

La forma más sencilla de compartir una app es:

- Crear una cuenta en https://www.shinyapps.io/ (puedes asociar tu correo gmail)
- Luego crear una app.
- `rsconnect::deployApp("<ruta_a_la_aplicacion>")`, o:

![](imgs/publicar_screenshot_1.png)


---

class: center, middle, inverse

# Ejercicio: Subir una aplicación

---

class: center, middle, inverse

# Ejercicio: Remotando todo lo anteior

---

# Ejercicio: Remotando todo lo anteior

<br>

- Cree un proyecto en RStudio, Cree una shinyapp.
- Descargue el archivo http://datos.gob.cl/dataset/33353
- Procese el archivo anterior para obtener un .rds o un csv más limpio.
- Ahora que su aplicación considere tener un selector de comunas, y que su 
aplicación retorne un mapa con las ubicaciones de los lugares de cargasbip
de la comuna seleccionada usando como template el primer ejemplo de https://rstudio.github.io/leaflet/markers.html y https://rstudio.github.io/leaflet/shiny.html

