library(shiny)
library(forecast)
library(xts)
library(tradestatistics)
library(ggplot2)

paises_opt <- tradestatistics::ots_countries$country_iso
nombres <- tradestatistics::ots_countries$country_name_english

paises_opt <- setNames(paises_opt, nombres)

# c("chl", "arg", "bol")
# paises_opt <- c(Chile  = "chl", Argenita = "arg", Bolivia = "bol")

plot_pais <- function(cod) {
    
    pais <- cod
    
    data <- ots_create_tidy_data(years = 1990:2018, reporters = pais, table = "yr")
    
    valores <- data$export_value_usd
    
    fechas <- as.Date(paste0(data$year, "0101"), format = "%Y%m%d",)
    
    serie <- xts(valores, order.by = fechas)
    
    prediccion <- forecast(serie, h = 5)
    
    autoplot(prediccion)
}

ui <- fluidPage(
    sidebarLayout(
        sidebarPanel(
            # textInput("pais", "Ingrese país")
            selectInput("pais", label = "Ingrese País", choices = paises_opt)
        ),
        mainPanel(
           plotOutput("grafico")
        )
    )
)

server <- function(input, output) {

    output$grafico <- renderPlot({
    
      plot_pais(input$pais)
        
    })
    
}

shinyApp(ui = ui, server = server)
